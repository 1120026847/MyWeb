<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬”è®°</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ““</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/quill/2.0.0-rc.2/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/quill/2.0.0-rc.2/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/feather-icons/4.29.1/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cos-js-sdk-v5/dist/cos-js-sdk-v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': { 'light': '#f0f4f8', 'DEFAULT': '#3b82f6', 'dark': '#1e40af' }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #c4c4c4; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        #sidebar { transition: margin-left 0.3s ease-in-out; }
        #main-app-view.sidebar-collapsed #sidebar { margin-left: -18rem; }
        .folder-toggle-icon.collapsed { transform: rotate(-90deg); }
        .folder-toggle-icon { transition: transform 0.2s ease-in-out; }
        #editor-container { height: 100%; min-height: 60vh; }
        .ql-editor { font-size: 16px; line-height: 1.6; }
        .ql-toolbar.ql-snow { border-radius: 8px 8px 0 0; }
        .ql-container.ql-snow { border-radius: 0 0 8px 8px; height: calc(100% - 42px); }
        #toast { transition: transform 0.3s ease-in-out; }
        summary::-webkit-details-marker { display: none; }
        .editor-drag-over { border: 2px dashed #3b82f6 !important; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        #pdf-viewer-container { flex-grow: 1; overflow-y: auto; background-color: #f8f9fa; }
        #pdf-viewer { display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
        #pdf-viewer canvas { max-width: 100%; height: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* æ–°å¢žï¼šæ ‡é¢˜æ æ˜¾éšçš„æ ·å¼ */
        #main-content > header { transition: transform 0.3s ease-in-out; }
        #main-app-view.header-collapsed #main-content > header { transform: translateY(-100%); }
        #show-header-button { display: none; }
        #main-app-view.header-collapsed #show-header-button { display: flex; }
    </style>
</head>
<body class="bg-white antialiased text-slate-800">
    <div id="app" class="relative min-h-screen">
        <div id="auth-view" class="flex items-center justify-center min-h-screen bg-brand-light">
           </div>

        <div id="main-app-view" class="hidden h-screen w-full flex overflow-hidden">
             <aside id="sidebar" class="w-72 h-full bg-brand-light border-r border-slate-200 flex flex-col flex-shrink-0 fixed md:static inset-y-0 left-0 z-40 transform transition-transform -translate-x-full md:translate-x-0">
                </aside>

            <div id="sidebar-overlay" class="fixed inset-0 bg-black/40 z-30 hidden md:hidden"></div>

            <main id="main-content" class="flex-1 flex flex-col bg-white overflow-hidden relative">
                <header class="flex items-center justify-between p-2 border-b border-slate-200 bg-white relative flex-shrink-0 z-20">
                    <div class="flex items-center flex-1 min-w-0">
                        <button id="toggle-sidebar-button" class="p-2 rounded-md hover:bg-slate-100 flex-shrink-0"><i data-feather="menu" class="w-6 h-6"></i></button>
                        <h2 id="article-main-title" class="text-lg font-semibold truncate ml-2">ç¬”è®°</h2>
                    </div>

                    <div id="header-pdf-controls" class="hidden items-center space-x-4">
                        <button id="pdf-prev-page" class="p-2 rounded-md hover:bg-slate-200"><i data-feather="arrow-left"></i></button>
                        <span>ç¬¬ <span id="pdf-current-page"></span> / <span id="pdf-total-pages"></span> é¡µ</span>
                        <button id="pdf-next-page" class="p-2 rounded-md hover:bg-slate-200"><i data-feather="arrow-right"></i></button>
                    </div>

                    <div class="flex items-center flex-1 justify-end">
                        <div id="article-actions" class="hidden md:flex items-center space-x-2">
                            <button id="global-move-button" title="ç§»åŠ¨æ–‡ç« " class="flex items-center p-2 text-sm bg-slate-100 rounded-md hover:bg-slate-200"><i data-feather="move" class="w-4 h-4"></i></button>
                        </div>
                        <div id="mobile-controls" class="flex items-center flex-shrink-0 md:hidden">
                           </div>
                        <button id="toggle-header-button" title="åˆ‡æ¢æ ‡é¢˜æ " class="p-2 rounded-md hover:bg-slate-100 flex-shrink-0 ml-2">
                            <i data-feather="chevron-up"></i>
                        </button>
                    </div>
                </header>

                <button id="show-header-button" title="æ˜¾ç¤ºæ ‡é¢˜æ " class="absolute top-0 right-2 p-2 rounded-b-md bg-slate-100 hover:bg-slate-200 z-30 shadow-md">
                    <i data-feather="chevron-down"></i>
                </button>

                <div id="welcome-view" class="flex-1 flex flex-col items-center justify-center text-center p-8">
                     </div>
                
                <div id="article-view" class="hidden flex-1 flex flex-col overflow-hidden">
                   </div>
            </main>
        </div>
        <div id="toast" class="fixed top-5 right-5 px-4 py-2 rounded-md text-white shadow-lg z-50" style="transform: translateX(150%);"></div>
        
        </div>

    <script type="module">
        // ... All JS code up to initializeApp ...
        const { jsPDF } = window.jspdf;
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        const SUPABASE_URL = 'https://cvkqzkipgmtzqprqadyn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3F6a2lwZ210enFwcnFhZHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MDMzMDIsImV4cCI6MjA3MzQ3OTMwMn0.I2DygNtjxa324smxKfIBHCOtFmrGQF4kRRkwPv-7VOY';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const cosConfig = { /* ... */ };
        let state = { /* ... */ };
        let quill;
        let toastTimeout;
        let pdfDoc = null;
        let currentPage = 1;
        let dom = {};
        const on = (el, type, handler) => el && el.addEventListener(type, handler);

        // ... All functions from showToast to handleForceReload, unchanged ...

        // --- æ–°å¢žï¼šæ ‡é¢˜æ æ˜¾éšæŽ§åˆ¶å‡½æ•° ---
        function toggleHeader(forceState) {
            const shouldBeCollapsed = forceState ? forceState === 'collapse' : !dom.mainAppView.classList.contains('header-collapsed');
            dom.mainAppView.classList.toggle('header-collapsed', shouldBeCollapsed);
            
            const icon = shouldBeCollapsed ? 'chevron-down' : 'chevron-up';
            dom.toggleHeaderButton.innerHTML = ''; // æ¸…ç©ºæ—§å›¾æ ‡
            const iconElement = document.createElement('i');
            iconElement.setAttribute('data-feather', icon);
            dom.toggleHeaderButton.appendChild(iconElement);
            feather.replace({ width: 16, height: 16 }); // é‡æ–°æ¸²æŸ“featherå›¾æ ‡

            localStorage.setItem('headerState', shouldBeCollapsed ? 'collapsed' : 'expanded');
        }

        function initEventListeners() {
            // ... All existing event listeners from on(dom.loginForm, ...) to on(quill.root, 'drop', ...), unchanged ...
            // æ–°å¢žæ ‡é¢˜æ æŽ§åˆ¶æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
            on(dom.toggleHeaderButton, 'click', () => toggleHeader());
            on(dom.showHeaderButton, 'click', () => toggleHeader());
        }

        function initQuill() {
           // ... Unchanged ...
        }

        async function initializeApp() {
            dom = {
                // ... all existing dom elements ...
                mainAppView: document.getElementById('main-app-view'),
                toggleHeaderButton: document.getElementById('toggle-header-button'),
                showHeaderButton: document.getElementById('show-header-button')
            };

            feather.replace();
            initQuill();
            initEventListeners();
             
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                // ... session handling, unchanged ...
            } else {
                // ... no session handling, unchanged ...
            }
            if (localStorage.getItem('sidebarCollapsed') === 'true' && window.innerWidth >= 768) { toggleSidebar('hide'); }
            
            // æ–°å¢žï¼šåˆå§‹åŒ–æ—¶æ¢å¤æ ‡é¢˜æ çŠ¶æ€
            const savedHeaderState = localStorage.getItem('headerState');
            if (savedHeaderState === 'collapsed') {
                toggleHeader('collapse');
            }

            supabase.auth.onAuthStateChange((_, session) => {
                // ... onAuthStateChange, unchanged ...
            });
        }
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>
